<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>マルチョウ専用 鰹相場データ</title>
    <meta name="apple-mobile-web-app-title" content="マルチョウ 鰹相場データ">
    <link rel="stylesheet" href="index.css?v=20260219-header-v2">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment@1.0.1"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- アイコン設定 -->
    <link rel="icon" type="image/png" href="marucyou_mark.png">
    <link rel="apple-touch-icon" href="marucyou_mark_white.png">
</head>

<body class="theme-dark"> <!-- デフォルトはダークモード -->
    <!-- スプラッシュ画面 -->
    <div id="splash-screen" class="splash-screen">
        <div class="splash-content">
            <img src="marucyou_mark_white.png" alt="Marucyou Logo" class="splash-logo">
            <div class="loader"></div>
        </div>
    </div>

    <div class="container">
        <header class="app-header">
            <div class="header-visual-container">
                <img src="header_visual.png" alt="鰹相場データ" class="header-main-visual">
                <div class="filter-controls-container">
                    <div class="header-action-row">
                        <div class="filter-group">
                            <button class="btn-filter" data-range="all">全期間推移</button>
                            <button class="btn-filter active" data-range="30">30日間</button>
                            <button class="btn-filter" data-range="7">7日間</button>
                        </div>
                        <div class="system-group">
                            <button id="btn-refresh" class="btn-system"><span class="icon">🔄</span> 更新</button>
                            <button id="btn-settings" class="btn-system"><span class="icon">⚙️</span> 設定</button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- 設定モーダル -->
        <div id="settings-modal" class="modal-overlay">
            <div class="settings-content">
                <div class="settings-header">
                    <h3>⚙️ アプリ設定</h3>
                    <button id="settings-close" class="btn-close">&times;</button>
                </div>
                <div class="settings-body">
                    <!-- テーマ選択 (6色) -->
                    <section class="settings-section">
                        <h4>🎨 表示テーマ</h4>
                        <div class="theme-grid">
                            <button class="theme-option" data-theme="dark"><span
                                    class="theme-preview dark"></span>Dark</button>
                            <button class="theme-option" data-theme="light"><span
                                    class="theme-preview light"></span>Light</button>
                            <button class="theme-option" data-theme="ocean"><span
                                    class="theme-preview ocean"></span>Ocean</button>
                            <button class="theme-option" data-theme="forest"><span
                                    class="theme-preview forest"></span>Forest</button>
                            <button class="theme-option" data-theme="sunset"><span
                                    class="theme-preview sunset"></span>Sunset</button>
                            <button class="theme-option" data-theme="graphite"><span
                                    class="theme-preview graphite"></span>Graphite</button>
                        </div>
                    </section>

                    <!-- 文字サイズ -->
                    <section class="settings-section">
                        <h4>📏 文字サイズ</h4>
                        <div class="setting-row">
                            <button class="btn-setting-toggle" data-font="small">小</button>
                            <button class="btn-setting-toggle active" data-font="medium">中</button>
                            <button class="btn-setting-toggle" data-font="large">大</button>
                        </div>
                    </section>

                    <!-- 追加オプション (6項目) -->
                    <section class="settings-section">
                        <h4>🚀 高度な設定</h4>
                        <div class="option-list">
                            <label class="option-item">
                                <span>港の表示: 枕崎</span>
                                <input type="checkbox" id="check-port-makurazaki" checked>
                            </label>
                            <label class="option-item">
                                <span>港の表示: 焼津</span>
                                <input type="checkbox" id="check-port-yaizu" checked>
                            </label>
                            <label class="option-item">
                                <span>港の表示: 山川</span>
                                <input type="checkbox" id="check-port-yamagawa" checked>
                            </label>
                            <hr>
                            <label class="option-item">
                                <span>コンパクトモード</span>
                                <input type="checkbox" id="check-compact">
                            </label>
                            <label class="option-item">
                                <span>アニメーション有効</span>
                                <input type="checkbox" id="check-animation" checked>
                            </label>
                            <label class="option-item">
                                <span>グラフ塗りつぶし</span>
                                <input type="checkbox" id="check-chart-fill" checked>
                            </label>
                        </div>
                    </section>
                </div>
            </div>
        </div>

        <nav class="main-tabs">
            <button class="tab-item active" data-tab="summary">📋 最新相場一覧</button>
            <button class="tab-item" data-tab="charts">📈 グラフ推移</button>
            <button class="tab-item" data-tab="bid-schedule">🚢 入札予定</button>
            <button class="tab-item" data-tab="topic">📰 トピック</button>
            <button class="tab-item" data-tab="calculator">🧮 原価計算</button>
        </nav>

        <!-- 最新一覧サマリービュー（初期表示） -->
        <div id="view-summary" class="tab-view active">
            <div id="summary-container" class="summary-grid">
                <!-- ここにJSでカードが生成されます -->
                <p>最新データを分析中...</p>
            </div>
        </div>

        <!-- ニュース・トピックビュー -->
        <div id="view-topic" class="tab-view">
            <div class="news-section">
                <div class="news-header">
                    <h3>⚓️ 市場に影響する最新トピック</h3>
                    <p class="news-subtitle">漁況・海況・燃費油などの背景情報</p>
                </div>
                <div id="news-container" class="news-grid">
                    <!-- ニュースカードがここに生成される -->
                    <div class="loading-news">ニュースを読み込んでいます...</div>
                </div>
                <div id="news-load-more-container" class="news-load-more-container" style="display:none;">
                    <button id="btn-load-more-news" class="btn-load-more">⚓️ もっと見る</button>
                </div>
            </div>
        </div>

        <!-- 原価計算機ビュー -->
        <div id="view-calculator" class="tab-view">
            <div class="calculator-section">
                <div class="calculator-header">
                    <h3>🧮 鰹節原価計算オリジナル計算機</h3>
                    <p class="calculator-subtitle">購入単価から販売の最低指標価格を算出します</p>
                </div>
                <div class="calculator-card">
                    <div class="calc-input-group">
                        <label for="calc-price">購入単価 (円/kg):</label>
                        <input type="number" id="calc-price" placeholder="例: 220" />
                    </div>
                    <div class="calc-input-group">
                        <label for="calc-multiplier">歩留まり掛率 (掛):</label>
                        <input type="number" id="calc-multiplier" placeholder="例: 5" value="5" step="0.1" />
                    </div>
                    <div class="calc-input-group">
                        <label for="calc-overhead">諸経費 (約・円):</label>
                        <input type="number" id="calc-overhead" placeholder="例: 250" value="250" />
                    </div>
                    <button id="btn-calculate" class="btn-calculate">計算する</button>

                    <div id="calc-result-box" class="calc-result-box" style="display:none;">
                        <h4>📝 計算結果（販売指標）</h4>
                        <div class="result-row">
                            <span>原料費 (単価 × 掛率):</span>
                            <span id="res-material-cost">--</span>
                        </div>
                        <div class="result-row">
                            <span>諸経費:</span>
                            <span id="res-overhead">--</span>
                        </div>
                        <hr class="result-divider">
                        <div class="result-row total">
                            <span>販売最低指標価格:</span>
                            <span id="res-total-price" class="total-price-value">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- グラフ表示ビュー -->
        <div id="view-charts" class="tab-view">
            <!-- (既存のグラフ表示内容) -->
            <div class="insight-section">
                <div class="insight-card">
                    <div class="insight-header">
                        <h3>🔍 相場トレンド・分析</h3>
                        <button id="btn-reload-insight" class="btn-refresh-insight">
                            <span class="icon">🔄</span> 分析を更新
                        </button>
                    </div>
                    <div id="insight-content" class="insight-content">
                        <p>データを読み込み中...</p>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                <!-- ...各港のグラフ... -->
                <div class="chart-card">
                    <div class="chart-header">
                        <span class="port-title">枕崎市漁業協同組合市況</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="chart-枕崎"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <span class="port-title">焼津魚市場市況</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="chart-焼津"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <span class="port-title">山川町漁業協同組合市況</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="chart-山川"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- 入札予定ビュー -->
        <div id="view-bid-schedule" class="tab-view">
            <div class="bid-section">
                <div id="latest-bid-container">
                    <!-- 最新の入札予定を表示 -->
                </div>

                <div class="archive-section">
                    <details>
                        <summary class="archive-summary">📁 過去の入札予定アーカイブを表示</summary>
                        <div id="archive-bid-container">
                            <!-- 過去のデータを表示 -->
                        </div>
                    </details>
                </div>
            </div>
        </div>

        <!-- 詳細表示モーダル -->
        <div id="detail-modal" class="modal-overlay">
            <div class="modal-content">
                <button id="modal-close" class="modal-close-btn">&times;</button>
                <div id="modal-body">
                    <!-- JSで詳細データが挿入されます -->
                </div>
            </div>
        </div>

        <!-- 相場メモ入力モーダル -->
        <div id="memo-modal" class="modal-overlay">
            <div class="modal-content">
                <div class="memo-modal-header">
                    <h3>📝 相場メモ</h3>
                    <span id="memo-date" class="memo-date-label"></span>
                    <span id="memo-port" data-date="" data-port=""></span>
                </div>
                <textarea id="memo-textarea" class="memo-textarea" placeholder="例：大型高。第88永盛丸の入港で水揚げ増加見込み。"
                    rows="5"></textarea>
                <div class="memo-modal-footer">
                    <button id="memo-cancel-btn" class="btn-filter">キャンセル</button>
                    <button id="memo-save-btn" class="btn-filter"
                        style="background:var(--accent-color);color:white;border-color:var(--accent-color)">保存</button>
                </div>
            </div>
        </div>

        <footer>
            <p>Data Source: 各市況データ</p>
            <p>&copy; 2026 Marucyou Skipjack Analytics</p>
        </footer>
    </div>

    <script src="dashboard.js?v=20260220-v1"></script>
</body>

</html>